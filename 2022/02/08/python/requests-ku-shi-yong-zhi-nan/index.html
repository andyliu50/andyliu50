<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="注：本文翻译自Python’s Requests Library (Guide)。  在Python中，requests库是处理HTTP请求的标准。它使得复杂的HTTP请求变得简单、易用，用户只需要专注于处理与Web服务之间的交互过程，并获取所需的数据。 通过本文，你可以学到许多requests库中的有用功能，并且可以根据实际的使用场景，定制和优化这些功能。你还会学到如何有效地使用request">
<meta property="og:type" content="article">
<meta property="og:title" content="Requests库使用指南">
<meta property="og:url" content="https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/index.html">
<meta property="og:site_name" content="Andy&#39;s Tech">
<meta property="og:description" content="注：本文翻译自Python’s Requests Library (Guide)。  在Python中，requests库是处理HTTP请求的标准。它使得复杂的HTTP请求变得简单、易用，用户只需要专注于处理与Web服务之间的交互过程，并获取所需的数据。 通过本文，你可以学到许多requests库中的有用功能，并且可以根据实际的使用场景，定制和优化这些功能。你还会学到如何有效地使用request">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-08T07:40:20.000Z">
<meta property="article:modified_time" content="2024-09-18T06:21:50.506Z">
<meta property="article:author" content="Andy">
<meta property="article:tag" content="requests">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Requests库使用指南</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2023/12/28/raspberrypi/zai-shu-mei-pai-shang-bu-shu-hexo-bo-ke/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2021/10/19/home-assistant/home-assistant-https/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&text=Requests库使用指南"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&is_video=false&description=Requests库使用指南"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Requests库使用指南&body=Check out this article: https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&name=Requests库使用指南&description=&lt;blockquote&gt;
&lt;p&gt;注：本文翻译自&lt;a href=&#34;https://realpython.com/python-requests/&#34;&gt;Python’s Requests Library (Guide)&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在Python中，&lt;code&gt;requests&lt;/code&gt;库是处理HTTP请求的标准。它使得复杂的HTTP请求变得简单、易用，用户只需要专注于处理与Web服务之间的交互过程，并获取所需的数据。&lt;/p&gt;
&lt;p&gt;通过本文，你可以学到许多&lt;code&gt;requests&lt;/code&gt;库中的有用功能，并且可以根据实际的使用场景，定制和优化这些功能。你还会学到如何有效地使用&lt;code&gt;requests&lt;/code&gt;库，避免由于网络的原因影响应用的响应速度。&lt;/p&gt;
&lt;p&gt;在本指南中，你将学到以下内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最常见的HTTP方式&lt;/li&gt;
&lt;li&gt;定制HTTP请求中的报头和数据，使用查询字符和消息内容&lt;/li&gt;
&lt;li&gt;检查请求和响应中的数据&lt;/li&gt;
&lt;li&gt;发送认证请求&lt;/li&gt;
&lt;li&gt;配置请求，防止应用的响应速度变慢&lt;/li&gt;
&lt;/ul&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&t=Requests库使用指南"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8requests"><span class="toc-number">1.</span> <span class="toc-text">开始使用requests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GET%E8%AF%B7%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">3.</span> <span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%88Status-Codes%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">状态码（Status Codes）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%EF%BC%88Content%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">内容（Content）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E5%A4%B4%EF%BC%88Headers%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">报头（Headers）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%82%E6%95%B0%EF%BC%88Query-String-Parameters%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">查询字符串参数（Query String Parameters）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%8A%A5%E5%A4%B4%EF%BC%88Request-Headers%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">请求报头（Request Headers）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%9A%84HTTP%E6%96%B9%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">其它的HTTP方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%AD%A3%E6%96%87"><span class="toc-number">8.</span> <span class="toc-text">消息正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%AF%B7%E6%B1%82"><span class="toc-number">9.</span> <span class="toc-text">检查请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81"><span class="toc-number">10.</span> <span class="toc-text">认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81"><span class="toc-number">11.</span> <span class="toc-text">SSL证书验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD"><span class="toc-number">12.</span> <span class="toc-text">性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Timeouts"><span class="toc-number">12.1.</span> <span class="toc-text">Timeouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Session-Object"><span class="toc-number">12.2.</span> <span class="toc-text">The Session Object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Max-Retries"><span class="toc-number">12.3.</span> <span class="toc-text">Max Retries</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">13.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        <header id="header">
  <a class="u-url u-uid" href="/">
  
    
      <img id="logo" alt class="u-logo" src="/images/logo.png" />
    
  
    <div id="title">
      <h1 class="p-name">Andy&#39;s Tech</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="目录"><i class="fa-solid fa-bars fa-2x"></i></a>
      </li>
      <!--
     --><li><a href="/">首页</a></li><!--
   --><!--
     --><li><a href="/about/">关于</a></li><!--
   --><!--
     --><li><a href="/tags/">标签</a></li><!--
   --><!--
     --><li><a href="/categories/">分类</a></li><!--
   --><!--
     --><li><a href="/archives/">归档</a></li><!--
   --><!--
     --><li><a href="/search/">搜索</a></li><!--
   -->
    </ul>
  </div>
</header>

        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Requests库使用指南
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Andy</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-08T07:40:20.000Z" class="dt-published" itemprop="datePublished">2022-02-08</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Python/">Python</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/requests/" rel="tag">requests</a>
    </div>


    </div>
    

  </header>
  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>注：本文翻译自<a target="_blank" rel="noopener" href="https://realpython.com/python-requests/">Python’s Requests Library (Guide)</a>。</p>
</blockquote>
<p>在Python中，<code>requests</code>库是处理HTTP请求的标准。它使得复杂的HTTP请求变得简单、易用，用户只需要专注于处理与Web服务之间的交互过程，并获取所需的数据。</p>
<p>通过本文，你可以学到许多<code>requests</code>库中的有用功能，并且可以根据实际的使用场景，定制和优化这些功能。你还会学到如何有效地使用<code>requests</code>库，避免由于网络的原因影响应用的响应速度。</p>
<p>在本指南中，你将学到以下内容：</p>
<ul>
<li>最常见的HTTP方式</li>
<li>定制HTTP请求中的报头和数据，使用查询字符和消息内容</li>
<li>检查请求和响应中的数据</li>
<li>发送认证请求</li>
<li>配置请求，防止应用的响应速度变慢</li>
</ul>
<span id="more"></span>

<h2 id="开始使用requests"><a href="#开始使用requests" class="headerlink" title="开始使用requests"></a>开始使用requests</h2><p>首先，需要安装<code>requests</code>库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$ </span><span class="language-bash">pip install requests</span></span><br></pre></td></tr></table></figure>

<p>安装完成后，需要先导入<code>requests</code>库：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br></pre></td></tr></table></figure>

<h2 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h2><p>HTTP有很多种请求方式，例如GET和POST，不同的请求方式，所执行的操作是不同的。其中，GET是最常用的HTTP请求。GET主要是用来获取Web数据。如果发起一个GET请求，就会调用<code>requests.get()</code>。</p>
<p>以下例子中，你可以看到通过调用<code>get()</code>发送GET请求给Github的<a target="_blank" rel="noopener" href="https://developer.github.com/v3/#root-endpoint">Root REST API</a>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>通过发送GET请求以后，我们可以得到一个Response的对象。将该对象存储到一个变量中后，我们可以查看该对象的属性和方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>在以上例子中，我们将响应对象存储到<code>response</code>变量中。</p>
<h3 id="状态码（Status-Codes）"><a href="#状态码（Status-Codes）" class="headerlink" title="状态码（Status Codes）"></a>状态码（Status Codes）</h3><p>从响应<code>Response</code>中首先可以获取状态码，通过状态码来判断请求是否成功。</p>
<p>例如，如果状态码是<code>200 OK</code>，那么说明请求是成功的，但是如果状态码是<code>404 NOT FOUND</code>，则说明未找到需要获取的资源。关于状态码的详细说明，请参考文档：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">many other possible status codes</a></p>
<p>通过访问响应<code>response</code>的属性<code>.status_code</code>，可以看到服务器返回的状态码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.status_code</span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>

<p><code>.status_code</code>返回的是<code>200</code>，说明请求时成功的，并且服务器返回了你需要获取的数据。</p>
<p>有些情况下，你可能想要通过状态码来作为判断条件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> response.status_code == <span class="number">404</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Not Found.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>以上例子中，如果服务器返回<code>200</code>的状态码，那么程序就会打印<code>Success!</code>。如果服务器返回<code>404</code>的状态码，程序就会打印<code>Not Found.</code>。</p>
<p><code>requests</code>提供了一种更为简便的方法。如果直接使用<code>Response</code>实例作为判断的条件，假设状态码在<code>200</code>和<code>400</code>之间，那么表达式就会被评估为<code>True</code>，否则就会被评估为<code>False</code>。</p>
<p>因此，你可以将之前的例子改写如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> response:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;An error has occurred.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>技术细节：This <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/stdtypes.html#truth-value-testing">Truth Value Test</a> is made possible because <a target="_blank" rel="noopener" href="https://realpython.com/operator-function-overloading/#making-your-objects-truthy-or-falsey-using-bool"><code>__bool__()</code> is an overloaded method</a> on <code>Response</code>.</p>
<p>This means that the default behavior of <code>Response</code> has been redefined to take the status code into account when determining the truth value of the object.</p>
</blockquote>
<p>记住这种方式并不是检验状态码是否等于<code>200</code>，而是检验状态码是否在<code>200</code>到<code>400</code>之间，例如<code>204 NO CONTENT</code>和<code>304 NOT MODIFIED</code>，也被认为是请求成功的。</p>
<p>例如，<code>204</code>是说明请求是成功的，但是返回的消息正文并没有任何内容。</p>
<p>因此，如果只是为了知道请求是否成功，可以使用这种简便的方法，否则，建议还是根据具体的状态码来判断。</p>
<p>有时候，可能你不希望用<code>if</code>语句来检查状态码，而是希望在请求失败的情况下，引发异常。那么你就可以使用<code>.raise_for_status()</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> HTTPError</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> [<span class="string">&#x27;https://api.github.com&#x27;</span>, <span class="string">&#x27;https://api.github.com/invalid&#x27;</span>]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If the response was successful, no Exception will be raised</span></span><br><span class="line">        response.raise_for_status()</span><br><span class="line">    <span class="keyword">except</span> HTTPError <span class="keyword">as</span> http_err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;HTTP error occurred: <span class="subst">&#123;http_err&#125;</span>&#x27;</span>)  <span class="comment"># Python 3.6</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;Other error occurred: <span class="subst">&#123;err&#125;</span>&#x27;</span>)  <span class="comment"># Python 3.6</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Success!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>如果你调用<code>.raise_for_status()</code>，就会对某些失败的状态码引发<code>HTTPError</code>的异常错误。如果状态码显示请求是成功的，那么程序就不会引发异常。</p>
<p>通过以上内容，你了解了很多关于如何处理状态码的知识。下面，你将看到如何查看服务器返回的具体数据内容。</p>
<h3 id="内容（Content）"><a href="#内容（Content）" class="headerlink" title="内容（Content）"></a>内容（Content）</h3><p>GET请求得到的响应经常包含很多有价值的信息，如消息正文中的payload。通过使用<code>Response</code>的属性和方法，你可以用不同的格式来查看payload。</p>
<p>用bytes的格式查看响应的内容，你可以使用<code>.content</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.content</span><br><span class="line"><span class="string">b&#x27;&#123;&quot;current_user_url&quot;:&quot;https://api.github.com/user&quot;,&quot;current_user_authorizations_html_url&quot;:&quot;https://github.com/settings/connections/applications&#123;/client_id&#125;&quot;,&quot;authorizations_url&quot;:&quot;https://api.github.com/authorizations&quot;,&quot;code_search_url&quot;:&quot;https://api.github.com/search/code?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;commit_search_url&quot;:&quot;https://api.github.com/search/commits?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;emails_url&quot;:&quot;https://api.github.com/user/emails&quot;,&quot;emojis_url&quot;:&quot;https://api.github.com/emojis&quot;,&quot;events_url&quot;:&quot;https://api.github.com/events&quot;,&quot;feeds_url&quot;:&quot;https://api.github.com/feeds&quot;,&quot;followers_url&quot;:&quot;https://api.github.com/user/followers&quot;,&quot;following_url&quot;:&quot;https://api.github.com/user/following&#123;/target&#125;&quot;,&quot;gists_url&quot;:&quot;https://api.github.com/gists&#123;/gist_id&#125;&quot;,&quot;hub_url&quot;:&quot;https://api.github.com/hub&quot;,&quot;issue_search_url&quot;:&quot;https://api.github.com/search/issues?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;issues_url&quot;:&quot;https://api.github.com/issues&quot;,&quot;keys_url&quot;:&quot;https://api.github.com/user/keys&quot;,&quot;notifications_url&quot;:&quot;https://api.github.com/notifications&quot;,&quot;organization_repositories_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;organization_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;&quot;,&quot;public_gists_url&quot;:&quot;https://api.github.com/gists/public&quot;,&quot;rate_limit_url&quot;:&quot;https://api.github.com/rate_limit&quot;,&quot;repository_url&quot;:&quot;https://api.github.com/repos/&#123;owner&#125;/&#123;repo&#125;&quot;,&quot;repository_search_url&quot;:&quot;https://api.github.com/search/repositories?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;current_user_repositories_url&quot;:&quot;https://api.github.com/user/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;starred_url&quot;:&quot;https://api.github.com/user/starred&#123;/owner&#125;&#123;/repo&#125;&quot;,&quot;starred_gists_url&quot;:&quot;https://api.github.com/gists/starred&quot;,&quot;team_url&quot;:&quot;https://api.github.com/teams&quot;,&quot;user_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;&quot;,&quot;user_organizations_url&quot;:&quot;https://api.github.com/user/orgs&quot;,&quot;user_repositories_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;user_search_url&quot;:&quot;https://api.github.com/search/users?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>通过<code>.content</code>读取到的是字节格式的payload，如果你想要将其转换成UTF-8编码的字符串，你可以使用<code>.text</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.text</span><br><span class="line"><span class="string">&#x27;&#123;&quot;current_user_url&quot;:&quot;https://api.github.com/user&quot;,&quot;current_user_authorizations_html_url&quot;:&quot;https://github.com/settings/connections/applications&#123;/client_id&#125;&quot;,&quot;authorizations_url&quot;:&quot;https://api.github.com/authorizations&quot;,&quot;code_search_url&quot;:&quot;https://api.github.com/search/code?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;commit_search_url&quot;:&quot;https://api.github.com/search/commits?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;emails_url&quot;:&quot;https://api.github.com/user/emails&quot;,&quot;emojis_url&quot;:&quot;https://api.github.com/emojis&quot;,&quot;events_url&quot;:&quot;https://api.github.com/events&quot;,&quot;feeds_url&quot;:&quot;https://api.github.com/feeds&quot;,&quot;followers_url&quot;:&quot;https://api.github.com/user/followers&quot;,&quot;following_url&quot;:&quot;https://api.github.com/user/following&#123;/target&#125;&quot;,&quot;gists_url&quot;:&quot;https://api.github.com/gists&#123;/gist_id&#125;&quot;,&quot;hub_url&quot;:&quot;https://api.github.com/hub&quot;,&quot;issue_search_url&quot;:&quot;https://api.github.com/search/issues?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;issues_url&quot;:&quot;https://api.github.com/issues&quot;,&quot;keys_url&quot;:&quot;https://api.github.com/user/keys&quot;,&quot;notifications_url&quot;:&quot;https://api.github.com/notifications&quot;,&quot;organization_repositories_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;organization_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;&quot;,&quot;public_gists_url&quot;:&quot;https://api.github.com/gists/public&quot;,&quot;rate_limit_url&quot;:&quot;https://api.github.com/rate_limit&quot;,&quot;repository_url&quot;:&quot;https://api.github.com/repos/&#123;owner&#125;/&#123;repo&#125;&quot;,&quot;repository_search_url&quot;:&quot;https://api.github.com/search/repositories?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;current_user_repositories_url&quot;:&quot;https://api.github.com/user/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;starred_url&quot;:&quot;https://api.github.com/user/starred&#123;/owner&#125;&#123;/repo&#125;&quot;,&quot;starred_gists_url&quot;:&quot;https://api.github.com/gists/starred&quot;,&quot;team_url&quot;:&quot;https://api.github.com/teams&quot;,&quot;user_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;&quot;,&quot;user_organizations_url&quot;:&quot;https://api.github.com/user/orgs&quot;,&quot;user_repositories_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;user_search_url&quot;:&quot;https://api.github.com/search/users?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>因为将<code>bytes</code>转换成<code>str</code>需要指定编码的方式，<code>requests</code>会根据响应中的<code>hearders</code>内容来猜测编码的方式，或者，你也可以通过设置<code>.encoding</code>指定编码的方式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.encoding = <span class="string">&#x27;utf-8&#x27;</span> <span class="comment"># Optional: requests infers this internally</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.text</span><br><span class="line"><span class="string">&#x27;&#123;&quot;current_user_url&quot;:&quot;https://api.github.com/user&quot;,&quot;current_user_authorizations_html_url&quot;:&quot;https://github.com/settings/connections/applications&#123;/client_id&#125;&quot;,&quot;authorizations_url&quot;:&quot;https://api.github.com/authorizations&quot;,&quot;code_search_url&quot;:&quot;https://api.github.com/search/code?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;commit_search_url&quot;:&quot;https://api.github.com/search/commits?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;emails_url&quot;:&quot;https://api.github.com/user/emails&quot;,&quot;emojis_url&quot;:&quot;https://api.github.com/emojis&quot;,&quot;events_url&quot;:&quot;https://api.github.com/events&quot;,&quot;feeds_url&quot;:&quot;https://api.github.com/feeds&quot;,&quot;followers_url&quot;:&quot;https://api.github.com/user/followers&quot;,&quot;following_url&quot;:&quot;https://api.github.com/user/following&#123;/target&#125;&quot;,&quot;gists_url&quot;:&quot;https://api.github.com/gists&#123;/gist_id&#125;&quot;,&quot;hub_url&quot;:&quot;https://api.github.com/hub&quot;,&quot;issue_search_url&quot;:&quot;https://api.github.com/search/issues?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;issues_url&quot;:&quot;https://api.github.com/issues&quot;,&quot;keys_url&quot;:&quot;https://api.github.com/user/keys&quot;,&quot;notifications_url&quot;:&quot;https://api.github.com/notifications&quot;,&quot;organization_repositories_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;organization_url&quot;:&quot;https://api.github.com/orgs/&#123;org&#125;&quot;,&quot;public_gists_url&quot;:&quot;https://api.github.com/gists/public&quot;,&quot;rate_limit_url&quot;:&quot;https://api.github.com/rate_limit&quot;,&quot;repository_url&quot;:&quot;https://api.github.com/repos/&#123;owner&#125;/&#123;repo&#125;&quot;,&quot;repository_search_url&quot;:&quot;https://api.github.com/search/repositories?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;,&quot;current_user_repositories_url&quot;:&quot;https://api.github.com/user/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;starred_url&quot;:&quot;https://api.github.com/user/starred&#123;/owner&#125;&#123;/repo&#125;&quot;,&quot;starred_gists_url&quot;:&quot;https://api.github.com/gists/starred&quot;,&quot;team_url&quot;:&quot;https://api.github.com/teams&quot;,&quot;user_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;&quot;,&quot;user_organizations_url&quot;:&quot;https://api.github.com/user/orgs&quot;,&quot;user_repositories_url&quot;:&quot;https://api.github.com/users/&#123;user&#125;/repos&#123;?type,page,per_page,sort&#125;&quot;,&quot;user_search_url&quot;:&quot;https://api.github.com/search/users?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果你仔细看一下响应的内容，你会发现实际上是序列化的<code>JSON</code>内容。因此，你可以通过<code>.text</code>的方式先获取字符串，然后再通过<a target="_blank" rel="noopener" href="https://realpython.com/python-json/#deserializing-json"><code>json.loads()</code></a>的方式获取字典。其实，还有一种更为简单的方法，可以使用<code>.json()</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.json()</span><br><span class="line">&#123;<span class="string">&#x27;current_user_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user&#x27;</span>, <span class="string">&#x27;current_user_authorizations_html_url&#x27;</span>: <span class="string">&#x27;https://github.com/settings/connections/applications&#123;/client_id&#125;&#x27;</span>, <span class="string">&#x27;authorizations_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/authorizations&#x27;</span>, <span class="string">&#x27;code_search_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/search/code?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&#x27;</span>, <span class="string">&#x27;commit_search_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/search/commits?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&#x27;</span>, <span class="string">&#x27;emails_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/emails&#x27;</span>, <span class="string">&#x27;emojis_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/emojis&#x27;</span>, <span class="string">&#x27;events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/events&#x27;</span>, <span class="string">&#x27;feeds_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/feeds&#x27;</span>, <span class="string">&#x27;followers_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/followers&#x27;</span>, <span class="string">&#x27;following_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/following&#123;/target&#125;&#x27;</span>, <span class="string">&#x27;gists_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/gists&#123;/gist_id&#125;&#x27;</span>, <span class="string">&#x27;hub_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/hub&#x27;</span>, <span class="string">&#x27;issue_search_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/search/issues?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&#x27;</span>, <span class="string">&#x27;issues_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/issues&#x27;</span>, <span class="string">&#x27;keys_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/keys&#x27;</span>, <span class="string">&#x27;notifications_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/notifications&#x27;</span>, <span class="string">&#x27;organization_repositories_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/orgs/&#123;org&#125;/repos&#123;?type,page,per_page,sort&#125;&#x27;</span>, <span class="string">&#x27;organization_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/orgs/&#123;org&#125;&#x27;</span>, <span class="string">&#x27;public_gists_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/gists/public&#x27;</span>, <span class="string">&#x27;rate_limit_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/rate_limit&#x27;</span>, <span class="string">&#x27;repository_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/&#123;owner&#125;/&#123;repo&#125;&#x27;</span>, <span class="string">&#x27;repository_search_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/search/repositories?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&#x27;</span>, <span class="string">&#x27;current_user_repositories_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/repos&#123;?type,page,per_page,sort&#125;&#x27;</span>, <span class="string">&#x27;starred_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/starred&#123;/owner&#125;&#123;/repo&#125;&#x27;</span>, <span class="string">&#x27;starred_gists_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/gists/starred&#x27;</span>, <span class="string">&#x27;team_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/teams&#x27;</span>, <span class="string">&#x27;user_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/&#123;user&#125;&#x27;</span>, <span class="string">&#x27;user_organizations_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/user/orgs&#x27;</span>, <span class="string">&#x27;user_repositories_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/&#123;user&#125;/repos&#123;?type,page,per_page,sort&#125;&#x27;</span>, <span class="string">&#x27;user_search_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/search/users?q=&#123;query&#125;&#123;&amp;page,per_page,sort,order&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>.json()</code>返回的结果是一个字典，因此你可以通过键来访问字典中的值。</p>
<p>除了状态码和消息正文，你还可以查看响应中的Headers。</p>
<h2 id="报头（Headers）"><a href="#报头（Headers）" class="headerlink" title="报头（Headers）"></a>报头（Headers）</h2><p>响应中的报头通常包含很多有用的信息，例如内容类型，缓存内容的时间限制。</p>
<p>可以通过<code>.headers</code>来查看报头的内容：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.headers</span><br><span class="line">&#123;<span class="string">&#x27;Server&#x27;</span>: <span class="string">&#x27;GitHub.com&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>: <span class="string">&#x27;Mon, 10 Dec 2018 17:49:54 GMT&#x27;</span>, <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json; charset=utf-8&#x27;</span>, <span class="string">&#x27;Transfer-Encoding&#x27;</span>: <span class="string">&#x27;chunked&#x27;</span>, <span class="string">&#x27;Status&#x27;</span>: <span class="string">&#x27;200 OK&#x27;</span>, <span class="string">&#x27;X-RateLimit-Limit&#x27;</span>: <span class="string">&#x27;60&#x27;</span>, <span class="string">&#x27;X-RateLimit-Remaining&#x27;</span>: <span class="string">&#x27;59&#x27;</span>, <span class="string">&#x27;X-RateLimit-Reset&#x27;</span>: <span class="string">&#x27;1544467794&#x27;</span>, <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;public, max-age=60, s-maxage=60&#x27;</span>, <span class="string">&#x27;Vary&#x27;</span>: <span class="string">&#x27;Accept&#x27;</span>, <span class="string">&#x27;ETag&#x27;</span>: <span class="string">&#x27;W/&quot;7dc470913f1fe9bb6c7355b50a0737bc&quot;&#x27;</span>, <span class="string">&#x27;X-GitHub-Media-Type&#x27;</span>: <span class="string">&#x27;github.v3; format=json&#x27;</span>, <span class="string">&#x27;Access-Control-Expose-Headers&#x27;</span>: <span class="string">&#x27;ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type&#x27;</span>, <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="string">&#x27;max-age=31536000; includeSubdomains; preload&#x27;</span>, <span class="string">&#x27;X-Frame-Options&#x27;</span>: <span class="string">&#x27;deny&#x27;</span>, <span class="string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="string">&#x27;nosniff&#x27;</span>, <span class="string">&#x27;X-XSS-Protection&#x27;</span>: <span class="string">&#x27;1; mode=block&#x27;</span>, <span class="string">&#x27;Referrer-Policy&#x27;</span>: <span class="string">&#x27;origin-when-cross-origin, strict-origin-when-cross-origin&#x27;</span>, <span class="string">&#x27;Content-Security-Policy&#x27;</span>: <span class="string">&quot;default-src &#x27;none&#x27;&quot;</span>, <span class="string">&#x27;Content-Encoding&#x27;</span>: <span class="string">&#x27;gzip&#x27;</span>, <span class="string">&#x27;X-GitHub-Request-Id&#x27;</span>: <span class="string">&#x27;E439:4581:CF2351:1CA3E06:5C0EA741&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>.headers</code>返回的是字典类型的<strong>对象</strong>，因此，你可以像访问字典一样来获取值：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.headers[<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;application/json; charset=utf-8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>headers对象有一个特殊的地方。由于HTTP标准定义headers不区分大小写，所以，我们访问headers的时候，不需要担心大小写：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.headers[<span class="string">&#x27;content-type&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;application/json; charset=utf-8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>以上例子中，无论使用<code>content-type</code>还是<code>Content-Type</code>，你都能得到相同的结果。</p>
<h2 id="查询字符串参数（Query-String-Parameters）"><a href="#查询字符串参数（Query-String-Parameters）" class="headerlink" title="查询字符串参数（Query String Parameters）"></a>查询字符串参数（Query String Parameters）</h2><p>通过在URL中传递查询字符串参数，可以定制GET请求。在方法<code>get()</code>中，可以传递参数<code>params</code>。例如，你可以使用GitHub的查询API来查找<code>requests</code>库。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Search GitHub&#x27;s repositories for requests</span></span><br><span class="line">response = requests.get(</span><br><span class="line">    <span class="string">&#x27;https://api.github.com/search/repositories&#x27;</span>,</span><br><span class="line">    params=&#123;<span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;requests+language:python&#x27;</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inspect some attributes of the `requests` repository</span></span><br><span class="line">json_response = response.json()</span><br><span class="line">repository = json_response[<span class="string">&#x27;items&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Repository name: <span class="subst">&#123;repository[<span class="string">&quot;name&quot;</span>]&#125;</span>&#x27;</span>)  <span class="comment"># Python 3.6+</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Repository description: <span class="subst">&#123;repository[<span class="string">&quot;description&quot;</span>]&#125;</span>&#x27;</span>)  <span class="comment"># Python 3.6+</span></span><br></pre></td></tr></table></figure>

<p>在方法<code>.get()</code>中，通过将字典<code>&#123;&#39;q&#39;: &#39;requests+language:python&#39;&#125;</code>传递给参数<code>params</code>，你可以改变从查询API返回的结果。</p>
<p>你也可以用字典作为参数<code>params</code>的值，也可以使用以元组为成员的数组作为参数<code>params</code>的值：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;https://api.github.com/search/repositories&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>    params=[(<span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;requests+language:python&#x27;</span>)],</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>甚至，你还可以传递bytes作为值传递给参数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;https://api.github.com/search/repositories&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>    params=<span class="string">b&#x27;q=requests+language:python&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>查询字符串对于自定义GET请求非常有用。同时，你还可以通过添加或者修改报头来自定义GET请求。</p>
<h2 id="请求报头（Request-Headers）"><a href="#请求报头（Request-Headers）" class="headerlink" title="请求报头（Request Headers）"></a>请求报头（Request Headers）</h2><p>在方法<code>.get()</code>中，你可以通过将字典作为值传递给参数<code>headers</code>的方式，来自定义报头。例如，在之前的查询例子中，你可以通过在<code>Accept</code>报头中指定<code>text-match</code>类型：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(</span><br><span class="line">    <span class="string">&#x27;https://api.github.com/search/repositories&#x27;</span>,</span><br><span class="line">    params=&#123;<span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;requests+language:python&#x27;</span>&#125;,</span><br><span class="line">    headers=&#123;<span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/vnd.github.v3.text-match+json&#x27;</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># View the new `text-matches` array which provides information</span></span><br><span class="line"><span class="comment"># about your search term within the results</span></span><br><span class="line">json_response = response.json()</span><br><span class="line">repository = json_response[<span class="string">&#x27;items&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Text matches: <span class="subst">&#123;repository[<span class="string">&quot;text_matches&quot;</span>]&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>Accept</code>报头可以告诉服务器，你的应用可以处理的消息正文类型。在本例中，你使用的报头值是<code>application/vnd.github.v3.text-match+json</code>，这是GitHub网站<code>Accept</code>报头的专有属性，正文内容是一种特殊的JSON格式。</p>
<p>在学习其它自定义请求的方式之前，我们先简单了解一下其它的HTTP方法。</p>
<h2 id="其它的HTTP方法"><a href="#其它的HTTP方法" class="headerlink" title="其它的HTTP方法"></a>其它的HTTP方法</h2><p>除了GET以前，HTTP还支持<code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>HEAD</code>, <code>PATCH</code>和<code>OPTIONS</code>。在<code>requests</code>库中给，这些方法的使用方法和<code>get()</code>相似：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>, data=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.put(<span class="string">&#x27;https://httpbin.org/put&#x27;</span>, data=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.delete(<span class="string">&#x27;https://httpbin.org/delete&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.head(<span class="string">&#x27;https://httpbin.org/get&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.patch(<span class="string">&#x27;https://httpbin.org/patch&#x27;</span>, data=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.options(<span class="string">&#x27;https://httpbin.org/get&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>以下例子中，每一个函数调用都会对httpbin服务发起相应的HTTP方法。每一种方法，你都可以使用和之前相同的方式，查看服务器响应的内容：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.head(<span class="string">&#x27;https://httpbin.org/get&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.headers[<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;application/json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.delete(<span class="string">&#x27;https://httpbin.org/delete&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_response = response.json()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_response[<span class="string">&#x27;args&#x27;</span>]</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>报头、响应正文、状态码和其它信息都会包含在每一种HTTP方法的<code>Response</code>中。接下来，你将更为详细地了解<code>POST</code>，<code>PUT</code>和<code>PATCH</code>方法，以及它们之间的区别。</p>
<h2 id="消息正文"><a href="#消息正文" class="headerlink" title="消息正文"></a>消息正文</h2><p>根据HTTP的规格说明，<code>POST</code>，<code>PUT</code>和<code>PATCH</code>都是通过将数据传递给消息正文，而不是通过将查询字符串传递给参数的方式。通过使用<code>requests</code>，你可以将<code>payload</code>传递给<code>data</code>参数。</p>
<p>你可以将字典，元组为成员的列表或者文件对象传递给参数<code>data</code>。在请求的正文中，根据具体的类型需要，你可以采用不同的数据类型：</p>
<p>例如，如果你请求的内容类型为<code>application/x-www-form-urlencoded</code>，那么你就可以将字典作为表格数据，传递给参数<code>data</code>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>, data=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>你也可以使用以元组为成员的列表：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>, data=[(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)])</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>但是，如果你需要发送JSON格式的数据，你可以使用参数<code>json</code>。当你将值传递给参数<code>json</code>后，<code>requests</code>库会序列化你的数据和正确的<code>Content-Type</code>报头。</p>
<p><a target="_blank" rel="noopener" href="https://httpbin.org/">httpbin.org</a>是由<code>requests</code>库的开发者 <a target="_blank" rel="noopener" href="https://realpython.com/interview-kenneth-reitz/">Kenneth Reitz</a>创建的一个用于测试的网站。该网站可以用来测试<code>requests</code>发起的各种请求。例如，你可以用它来测试POST请求：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>, json=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_response = response.json()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_response[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#123;&quot;key&quot;: &quot;value&quot;&#125;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json_response[<span class="string">&#x27;headers&#x27;</span>][<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;application/json&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="检查请求"><a href="#检查请求" class="headerlink" title="检查请求"></a>检查请求</h2><p>在发送请求到服务器之前，<code>requests</code>库会先将请求准备好。请求的准备包括验证报头以及序列化JSON内容。</p>
<p>你可以通过<code>.request</code>来访问准备请求（<code>PrepareRequest</code>）：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>response = requests.post(<span class="string">&#x27;https://httpbin.org/post&#x27;</span>, json=&#123;<span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.request.headers[<span class="string">&#x27;Content-Type&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;application/json&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.request.url</span><br><span class="line"><span class="string">&#x27;https://httpbin.org/post&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.request.body</span><br><span class="line"><span class="string">b&#x27;&#123;&quot;key&quot;: &quot;value&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>检查准备请求可以让你访问各种信息，包括payload, URL, headers, authentication等等。</p>
<h2 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h2><p>认证可以让服务器知道你是谁。通常情况下，你可以通过<code>Authorization</code>报头提供你的身份信息，或者也可以通过自定义的报头来提供身份信息。在<code>requests</code>中，你可以使用参数<code>auth</code>来传递你的身份信息。</p>
<p>下面以GitHub的<a target="_blank" rel="noopener" href="https://developer.github.com/v3/users/#get-the-authenticated-user">Authenticated User</a> API为例。为了访问该API，你需要通过一个元组来传递用户名和密码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com/user&#x27;</span>, auth=(<span class="string">&#x27;username&#x27;</span>, getpass()))</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>如果身份信息正确，request请求就会返回成功过。如果request请求中没有包含身份信息，服务器就会返回<code>401 Unauthorized</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com/user&#x27;</span>)</span><br><span class="line">&lt;Response [<span class="number">401</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>当你通过以上这种方式传递身份信息的时候，实际上<code>requests</code>使用的是HTTP的 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic access authentication scheme</a>。</p>
<p>因此，你还可以使用<code>HTTPBasicAuth</code>来传递身份信息：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(</span><br><span class="line"><span class="meta">... </span>    <span class="string">&#x27;https://api.github.com/user&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>    auth=HTTPBasicAuth(<span class="string">&#x27;username&#x27;</span>, getpass())</span><br><span class="line"><span class="meta">... </span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>除了Basic认证方式以外，<code>requests</code>还支持其它认证方式，例如<code>HTTPDigestAuth</code>和<code>HTTPProxyAuth</code>。</p>
<p>你甚至还可以提供自定义的认证方式。但是，你必须首先创建一个继承<code>AuthBase</code>的子类。然后，你需要定义<code>__call__()</code>函数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> AuthBase</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TokenAuth</span>(<span class="title class_ inherited__">AuthBase</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Implements a custom authentication scheme.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, token</span>):</span><br><span class="line">        self.token = token</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, r</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Attach an API token to a custom auth header.&quot;&quot;&quot;</span></span><br><span class="line">        r.headers[<span class="string">&#x27;X-TokenAuth&#x27;</span>] = <span class="string">f&#x27;<span class="subst">&#123;self.token&#125;</span>&#x27;</span>  <span class="comment"># Python 3.6+</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">&#x27;https://httpbin.org/get&#x27;</span>, auth=TokenAuth(<span class="string">&#x27;12345abcde-token&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>以上例子中，自定义的类<code>TokenAuth</code>会收到一个Token，然后将收到的token放到<code>x-TokenAuth</code>报头中。</p>
<p>不健全的认证机制会导致安全隐患，所以除非有特殊需求，否则应该使用成熟的认证机制，比如Basic或者OAuth。</p>
<h2 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h2><p>任何时候，当发送和接收的信息比较机密，安全往往是最重要的。因此，当你访问安全站点的时候，都会通过SSL建立安全连接，这时候对服务器的SSL证书进行验证显得尤为重要。</p>
<p>默认情况下，<code>requests</code>已经为你执行了SSL证书的验证。但是，在某些情况下，你可能希望改变这种默认的行为。</p>
<p>如果你想要关闭SSL证书的验证，你可以将参数<code>verify</code>设置为<code>False</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>, verify=<span class="literal">False</span>)</span><br><span class="line">InsecureRequestWarning: Unverified HTTPS request <span class="keyword">is</span> being made. Adding certificate verification <span class="keyword">is</span> strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html<span class="comment">#ssl-warnings</span></span><br><span class="line">  InsecureRequestWarning)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>当你正在访问一个不安全的站点时，<code>requests</code>会发出警告信息提醒你。</p>
<blockquote>
<p>注意：<code>requests</code>使用<a target="_blank" rel="noopener" href="http://docs.python-requests.org/en/master/user/advanced/#ca-certificates"><code>certifi</code></a>来提供SSL证书的颁发机构（ Certificate Authorities）。这可以让<code>requests</code>知道有哪些可以信任的证书颁发机构。因此，你需要定期更新<code>certifi</code>来保证安全性。</p>
</blockquote>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>当在生产环境中使用<code>requests</code>的时候，特别需要考虑性能的影响。<code>requests</code>库的一些特性，例如超时控制（timeout control），会话（sessions）和重试限制（retry limits）可以使得应用运行得更流畅。</p>
<h3 id="Timeouts"><a href="#Timeouts" class="headerlink" title="Timeouts"></a>Timeouts</h3><p>当你向服务发送请求以后，你得应用将会等待服务端的响应，得到响应以后，才会执行下一步操作。如果应用等待的时间太长，请求就会一直处于等待状态，导致用户体验变差，或者后台任务挂起。</p>
<p>默认情况下，<code>requests</code>将会无限制地等待响应，所以你应该指定一个超时的时间值。你可以通过参数<code>timeout</code>来设置超时的时间值。<code>timeout</code>的值可以是整型或者浮点型，时间的单位是秒。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>, timeout=<span class="number">3.05</span>)</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>以上例子中，第一个请求的超时时间是1秒，第二个请求的超时时间是3.05秒。</p>
<p>你还可以传递一个<a target="_blank" rel="noopener" href="http://docs.python-requests.org/en/master/user/advanced/#timeouts">元组</a>给参数<code>timeout</code>，元组中的第一个值是TCP连接的超时时间（客户端和服务器之间建立连接的时长，通常建议设置为比3的倍数大一点），第二个值是数据传输的超时时间（建立连接后，等待响应的超时时间）：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>, timeout=(<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line">&lt;Response [<span class="number">200</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>如果请求建立连接的时间在2秒以内，建立连接后，接收数据的时间在5秒以内，那么就可以正常获取到响应。但是，如果请求超时，那么函数就会抛出一个<code>Timeout</code>的异常。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> Timeout</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">&#x27;https://api.github.com&#x27;</span>, timeout=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">except</span> Timeout:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The request timed out&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The request did not time out&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>你的程序可以捕获这个<code>Timeout</code>的异常，并做相应的处理。</p>
<h3 id="The-Session-Object"><a href="#The-Session-Object" class="headerlink" title="The Session Object"></a>The Session Object</h3><p>到目前为止，你都是使用<code>requests</code>的<code>get()</code>和<code>post()</code>来发送请求。这些函数隐藏了一些细节，例如连接是如何建立以及管理的。</p>
<p>实际上，这些细节都是由类<code>Session</code>来负责处理。如果你需要微调你的请求，或者改进性能，你需要直接使用<code>Session</code>的实例。</p>
<p>会话主要是在一些列的请求中，保持持久的参数。例如，如果你想要在多个请求中使用相同的认证信息，你就可以使用会话：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> getpass <span class="keyword">import</span> getpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># By using a context manager, you can ensure the resources used by</span></span><br><span class="line"><span class="comment"># the session will be released after use</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> session:</span><br><span class="line">    session.auth = (<span class="string">&#x27;username&#x27;</span>, getpass())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Instead of requests.get(), you&#x27;ll use session.get()</span></span><br><span class="line">    response = session.get(<span class="string">&#x27;https://api.github.com/user&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can inspect the response just like you did before</span></span><br><span class="line"><span class="built_in">print</span>(response.headers)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br></pre></td></tr></table></figure>

<p>每次你用session发起请求，一旦该会话在初始化时，设定了认证的身份信息，那么该身份信息就可以在多个requests中重复使用。</p>
<p>通过session改进性能，主要是通过保持长连接的方式。当你的应用通过Session来发起请求，它就会在连接池中长时间保持该连接。当应用想要再次连接到同一个服务器的时候，就可以重复使用连接池中的连接，而不需要再新建连接。</p>
<h3 id="Max-Retries"><a href="#Max-Retries" class="headerlink" title="Max Retries"></a>Max Retries</h3><p>当请求失败的时候，你可能希望应用重新发起同样的请求。但是，<code>requests</code>默认并不会帮你重新发送请求。为了实现这个功能，你需要使用<a target="_blank" rel="noopener" href="http://docs.python-requests.org/en/master/user/advanced/#transport-adapters">Transport Adapter</a>。</p>
<p>Transport Adapters可以让你为每一个需要访问的服务定义一组配置信息。例如，你想要所有访问<code>https://api.github.com</code>的请求失败后重复三次，你可以创建一个Transport Adapter，设置参数<code>max_retries</code>的值为3，并将其挂载到当前的会话上：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ConnectionError</span><br><span class="line"></span><br><span class="line">github_adapter = HTTPAdapter(max_retries=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use `github_adapter` for all requests to endpoints that start with this URL</span></span><br><span class="line">session.mount(<span class="string">&#x27;https://api.github.com&#x27;</span>, github_adapter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    session.get(<span class="string">&#x27;https://api.github.com&#x27;</span>)</span><br><span class="line"><span class="keyword">except</span> ConnectionError <span class="keyword">as</span> ce:</span><br><span class="line">    <span class="built_in">print</span>(ce)</span><br></pre></td></tr></table></figure>

<p>当你挂载github_adapter到会话的时候，会话会遵循该配置的设置。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上内容，你现在可以：</p>
<ul>
<li>发送不同的HTTP请求，例如：GET, POST, PUT</li>
<li>通过修改报头，认证，查询字符串和消息这个问，自定义请求</li>
<li>检查发送给服务器的数据，以及从服务器接收的数据</li>
<li>SSL证书验证</li>
<li>通过max_retries, timeout, Sessions和Transport Adapters，更有效的使用<code>requests</code></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8requests"><span class="toc-number">1.</span> <span class="toc-text">开始使用requests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GET%E8%AF%B7%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">GET请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">3.</span> <span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%88Status-Codes%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">状态码（Status Codes）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%EF%BC%88Content%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">内容（Content）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E5%A4%B4%EF%BC%88Headers%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">报头（Headers）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%82%E6%95%B0%EF%BC%88Query-String-Parameters%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">查询字符串参数（Query String Parameters）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%8A%A5%E5%A4%B4%EF%BC%88Request-Headers%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">请求报头（Request Headers）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%9A%84HTTP%E6%96%B9%E6%B3%95"><span class="toc-number">7.</span> <span class="toc-text">其它的HTTP方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%AD%A3%E6%96%87"><span class="toc-number">8.</span> <span class="toc-text">消息正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%AF%B7%E6%B1%82"><span class="toc-number">9.</span> <span class="toc-text">检查请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81"><span class="toc-number">10.</span> <span class="toc-text">认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81"><span class="toc-number">11.</span> <span class="toc-text">SSL证书验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD"><span class="toc-number">12.</span> <span class="toc-text">性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Timeouts"><span class="toc-number">12.1.</span> <span class="toc-text">Timeouts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Session-Object"><span class="toc-number">12.2.</span> <span class="toc-text">The Session Object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Max-Retries"><span class="toc-number">12.3.</span> <span class="toc-text">Max Retries</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">13.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&text=Requests库使用指南"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&is_video=false&description=Requests库使用指南"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Requests库使用指南&body=Check out this article: https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&title=Requests库使用指南"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&name=Requests库使用指南&description=&lt;blockquote&gt;
&lt;p&gt;注：本文翻译自&lt;a href=&#34;https://realpython.com/python-requests/&#34;&gt;Python’s Requests Library (Guide)&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在Python中，&lt;code&gt;requests&lt;/code&gt;库是处理HTTP请求的标准。它使得复杂的HTTP请求变得简单、易用，用户只需要专注于处理与Web服务之间的交互过程，并获取所需的数据。&lt;/p&gt;
&lt;p&gt;通过本文，你可以学到许多&lt;code&gt;requests&lt;/code&gt;库中的有用功能，并且可以根据实际的使用场景，定制和优化这些功能。你还会学到如何有效地使用&lt;code&gt;requests&lt;/code&gt;库，避免由于网络的原因影响应用的响应速度。&lt;/p&gt;
&lt;p&gt;在本指南中，你将学到以下内容：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;最常见的HTTP方式&lt;/li&gt;
&lt;li&gt;定制HTTP请求中的报头和数据，使用查询字符和消息内容&lt;/li&gt;
&lt;li&gt;检查请求和响应中的数据&lt;/li&gt;
&lt;li&gt;发送认证请求&lt;/li&gt;
&lt;li&gt;配置请求，防止应用的响应速度变慢&lt;/li&gt;
&lt;/ul&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://andyliu50.github.io/2022/02/08/python/requests-ku-shi-yong-zhi-nan/&t=Requests库使用指南"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    Andy
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
