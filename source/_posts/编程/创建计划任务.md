---
title: 创建计划任务
date: 2021-12-31 15:09
tags: 
 - powershell
categories: 
 - 编程
---
![PowerShell](powershell.png) 
本文主要介绍如何用PowerShell命令创建计划任务。

通过PowerShell创建计划任务稍微有点复杂，需要通过三条命令来分别设置Settings, Action和Trigger，然后再用命令`Register-ScheduledTask`创建任务。

**New-ScheduledTaskSettingsSet** - 该命令主要用于设置一些参数，例如网络连接可用时才运行任务，使用交流电源时运行任务等。

**New-ScheduledTaskAction** - 该命令设置需要运行的程序和脚本等。

**New-ScheduledTaskTrigger** - 该命令设置触发任务运行的条件，例如启动时，登录时，某个特定时间运行任务。

**Register-ScheduledTask** - 该命令需要利用以上三条命令的结果，创建任务。
<!-- more -->
以下的命令可以创建一个名为ResetPassword的计划任务，该任务会在系统启动的时候运行，并且只有**当网络连接可用时(-RunOnlyIfNetworkAvailable)**才会运行。该任务以SYSTEM账号运行，并且使用**最高权限运行(-RunLevel Highest)**。

```
$TaskName = 'ResetPassword'
$Setting = New-ScheduledTaskSettingsSet -RunOnlyIfNetworkAvailable
$Action = New-ScheduledTaskAction -Execute $BatchFile
$Trigger = New-ScheduledTaskTrigger -AtStartup
Register-ScheduledTask -TaskName $TaskName -Action $Action -Trigger $Trigger -Settings $Setting -User 'SYSTEM' -RunLevel Highest
```



以下的命令可以创建一个名为MonitorInternet的计划任务，该任务创建后，**会在5分钟以后触发运行，并且之后会无限期地每隔五分钟运行一次(-Once -At (Get-Date).Addminutes(5) -RepetitionInterval (New-TimeSpan -Minutes 5))**。并且，该任务设置了条件，即使切换到电池（笔记本电脑），也不要停止运行任务。

```
$TaskName = 'MonitorInternet'
$Setting = New-ScheduledTaskSettingsSet -DontStopIfGoingOnBatteries
$Action = New-ScheduledTaskAction -Execute $BatchFile
$Trigger = New-ScheduledTaskTrigger -Once -At (Get-Date).Addminutes(5) -RepetitionInterval (New-TimeSpan -Minutes 5)
Register-ScheduledTask -TaskName $TaskName -Action $Action -Trigger $Trigger -Settings $Setting -User 'SYSTEM'
```

